// csvke: reference the correct I2C node from the device tree of your raspberry pi, for example in Raspberry Pi 5, it is i2c6 for MIPI0 and i2c5 for MIPI1, https://github.com/raspberrypi/linux/blob/rpi-6.6.y/arch/arm64/boot/dts/broadcom/bcm2712-rpi-5-b.dts#L261
// compile: dtc -I dts -O dtb -o vc4-kms-dsi-dxq7d0023.dtbo vc4-kms-dsi-dxq7d0023.dts
// copy dtbo to overlays: sudo cp vc4-kms-dsi-dxq7d0023.dtbo /boot/overlays/

/dts-v1/;
/plugin/;

/ {
    compatible = "brcm,bcm2712"; // RPi5 = "brcm,bcm2712"

    fragment@0 {
        target = <&dsi1>; 
        __overlay__ {
            status = "okay";
            #address-cells= <1>;
            #size-cells = <0>;
            port {
                dsi_out_port: endpoint {
                    remote-endpoint = <&panel_dsi_port>;
                }; 
            };
            
            dxq7d0023: dxq7d0023@0 {
                compatible = "dxq,dxq7d0023";  //csvke: reference the correct compatible string from panel-chipone-icna3512.c of_device_id icna3512_of_match[]
                status = "okay";
                reg = <0>;
                reset-gpios = <&gpio 16 1>; // csvke: Adjust GPIO pin as needed, // cskve, pin 28 on fpc breakout board on orange dupont wire
                enable-gpios  = <&gpio 4 0>;    // LCD Enable
                dcdc-en-gpios = <&gpio 5 0>;    // LCD DC-DC Enable                
                // backlight = <&backlight>; csvke: WIP: Have not worked out on how to control backlight or if AMOLED control brightness that way
                // vddi-supply = <&regulator_vdd_panel>; // csvke: reference as VBAT in DXQ7D0023 datasheet, and more info in ICNA3512 datasheet page 13
                // vci-supply = <&regulator_vcc_panel>; // csvke: reference as VDDIO in DXQ7D0023 datasheet, and more info in ICNA3512 datasheet page 13
                port {
                    panel_dsi_port: endpoint {
                        remote-endpoint = <&dsi_out_port>;
                    };
                };
            };
        };
    };

    /* This is for the drive being developed */
    fragment@1 {
        target = <&i2c4>;
        __overlay__ {
            #address-cells = <1>;
            #size-cells = <0>;
            status = "okay";
            clock-frequency = <400000>;

            ft3519: ft3519@38 {
                compatible = "focaltech,fts";
                reg = <0x38>;
                defer-probe;
                interrupt-parent = <&gpio>;
                interrupts = <24 0x02>; /* GPIO24, falling edge */
                focaltech,display-coords = <0 0 1080 1920>;
                // focaltech,have-key = <0>; // WIP: Have not worked out what it does
                focaltech,reset-gpio = <&gpio 23 0x01>; /* GPIO23 for reset */
                focaltech,irq-gpio = <&gpio 24 0x02>;   /* GPIO24 for interrupt */
                // focaltech,key-number = <3>;  /* Optional: Number of virtual keys */
                // focaltech,keys = <KEY_VOLUMEUP KEY_VOLUMEDOWN KEY_HOME>; /* Example keys */
                // focaltech,key-x-coords = <100 200 300>; /* Example X coordinates */
                // focaltech,key-y-coords = <1800 1800 1800>; /* Example Y coordinates */
                // focaltech,dvdd-gpio = <&gpio 25 0>;  /* GPIO25 for DVDD */
                focaltech,max-touch-number = <10>;
                // vdd-supply = <&regulator_vdd_touch>;
                // vcc_i2c-supply = <&regulator_vcc_i2c_touch>;
                status = "okay";
            };
        };
    };

    // /* This is for the dummy driver */
    // fragment@1 {
    //     target = <&i2c4>; // Adjust this to the correct I2C bus
    //     __overlay__ {
    //         #address-cells = <1>;
    //         #size-cells = <0>;
    //         status = "okay";
    //         ft3519: ft3519@38 {
    //             compatible = "focaltech,test"; // csvke: this is a test driver
    //             reg = <0x38>;
    //             /* Focaltech GPIO Configuration */
    //             interrupt-parent = <&gpio>;
    //             interrupts = <24 2>; // GPIO24, falling edge
    //             focaltech,display-coords =  <0 0 1080 1920>;
    //             focaltech,have-key = <0>; // WIP: Have not worked out what it does
    //             reset-gpio = <&gpio 23 0>; // GPIO23 for reset
    //             irq-gpio = <&gpio 24 0>; // GPIO24 for interrupt
    //             focaltech,max-touch-number = <10>;
    //             vdd-supply = <&regulator_vdd_touch>; // Regulator for VDD
    //             vcc_i2c-supply = <&regulator_vcc_i2c_touch>; // Regulator for VCC_I2C
    //             // focaltech,tp_rst_high;
    //             status = "okay";
    //         };
    //     };
    // };

    fragment@2 {
        target-path = "/";
        __overlay__ {
            regulator_vdd_touch: regulator-vdd-touch {
                compatible = "regulator-fixed";
                regulator-name = "vdd_touch";
                regulator-min-microvolt = <3300000>;
                regulator-max-microvolt = <3300000>;
                gpio = <&gpio 25 0>;
                enable-active-high;
            };

            regulator_vcc_i2c_touch: regulator-vcc-i2c-touch {
                compatible = "regulator-fixed";
                regulator-name = "vcc_i2c_touch";
                regulator-min-microvolt = <1800000>;
                regulator-max-microvolt = <1800000>;
                gpio = <&gpio 26 0>;
                enable-active-high;
            };
        };
    };

    // Add panel regulators here if needed
    fragment@3 {
        target-path = "/";
        __overlay__ {
            // Example panel regulator definitions
            regulator_vdd_panel: regulator-vdd-panel {
                compatible = "regulator-fixed";
                regulator-name = "vdd_panel";
                regulator-min-microvolt = <3300000>;
                regulator-max-microvolt = <3300000>;
                gpio = <&gpio 8 0>;
                enable-active-high;
            };

            regulator_vcc_panel: regulator-vcc-panel {
                compatible = "regulator-fixed";
                regulator-name = "vcc_panel";
                regulator-min-microvolt = <1800000>;
                regulator-max-microvolt = <1800000>;
                gpio = <&gpio 9 0>;
                enable-active-high;
            };
        };
    };
};