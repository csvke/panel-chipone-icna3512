// csvke: compile and install commands
// dtc -@ -I dts -O dtb -o vc4-kms-dsi-dxq7d0023.dtbo vc4-kms-dsi-dxq7d0023.dts
// sudo cp vc4-kms-dsi-dxq7d0023.dtbo /boot/firmware/overlays/

// csvke: reference the correct I2C node from the device tree of your raspberry pi, for example in Raspberry Pi 5, it is i2c6 for MIPI0 and i2c5 for MIPI1, https://github.com/raspberrypi/linux/blob/rpi-6.6.y/arch/arm64/boot/dts/broadcom/bcm2712-rpi-5-b.dts#L261

/dts-v1/;
/plugin/;

/ {
    compatible = "brcm,bcm2712"; // RPi5 = "brcm,bcm2712"

    fragment@0 {
        target = <&dsi1>; 
        __overlay__ {
            status = "okay";
            #address-cells= <1>;
            #size-cells = <0>;
            port {
                dsi_out_port: endpoint {
                    remote-endpoint = <&panel_dsi_port>;
                }; 
            };
            
            dxq7d0023: dxq7d0023@0 {
                compatible = "dxq,dxq7d0023";  //csvke: reference the correct compatible string from panel-chipone-icna3512.c of_device_id icna3512_of_match[]
                status = "okay";
                reg = <0>;
                reset-gpios = <&gpio 16 1>; // csvke: Adjust GPIO pin as needed, // cskve, pin 28 on fpc breakout board on orange dupont wire
                enable-gpios  = <&gpio 4 0>;    // LCD Enable
				dcdc-en-gpios = <&gpio 5 0>;    // LCD DC-DC Enable                
                // backlight = <&backlight>; csvke: WIP: Have not worked out on how to control backlight or if AMOLED control brightness that way
                // vddi-supply = <&vddi_reg 24 1>; // csvke: reference as VBAT in DXQ7D0023 datasheet, and more info in ICNA3512 datasheet page 13
                // vci-supply = <&vci_reg 25 1>; // csvke: reference as VDDIO in DXQ7D0023 datasheet, and more info in ICNA3512 datasheet page 13
                port {
                    panel_dsi_port: endpoint {
                        remote-endpoint = <&dsi_out_port>;
                    };
                };
            };
        };
    };

    // fragment@1 {
    //     target-path = "/";
    //     __overlay__ {
    //         regulators {
    //             // vddi_reg: vddi {
    //             //     compatible = "regulator-fixed";
    //             //     regulator-name = "vddi";
    //             //     regulator-min-microvolt = <0>; //csvke: somehow DXQ manufacturer provided HDMI driver board is 3.3v, but the datasheet says 1.8v
    //             //     regulator-max-microvolt = <1800000>;
    //             //     regulator-always-on;
    //             //     gpio = <&gpio 24 1>; // csvke: WIP: Adjust GPIO pin as needed
    //             //     // enable-active-high;
    //             // };

    //             vci_reg: vci {
    //                 compatible = "regulator-fixed";
    //                 regulator-name = "vci";
    //                 regulator-min-microvolt = <0>; 
    //                 regulator-max-microvolt = <3300000>;
    //                 regulator-always-on;
    //                 gpio = <&gpio 25 1>; // csvke: WIP: Adjust GPIO pin as needed
    //                 // enable-active-high;
    //             };
    //         };
    //     };
    // };

    fragment@1 {
        target = <&i2c4>;
        __overlay__ {
            #address-cells = <1>;
            #size-cells = <0>; 
            status = "okay";        
            touchpanel: edt-ft5x06@38 {
                compatible = "edt,edt-ft5506";
				status = "okay";
				reg = <0x38>;
                // // vcc-supply = <&reg_vcc>;
                // // iovcc-supply = <&reg_iovcc>;
                interrupt-parent = <&gpio>;
                interrupts = <6 0x02>; // csvke: not sure about the type of interrupt, but it is the GPIO pin number. 0x01 for IRQ_TYPE_EDGE_RISING; 0x02 for IRQ_TYPE_EDGE_FALLING; 0x03 for IRQ_TYPE_EDGE_BOTH
                reset-gpios = <&gpio 5 1>; // csvke: Brown jumper wire
                wake-gpios = <&gpio 6 1>; // csvke: try to see if wake == irq
                irq-gpios = <&gpio 6 1>; // csvke: Purple jumper wire
                touchscreen-size-x = < 800 >; // csvke: 1080x1920
                touchscreen-size-y = < 480 >;
			};
        };
    };
};
